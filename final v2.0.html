<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Do Waht? å¤©æ°£æ¨è–¦ç³»çµ±</title>
  <style>
    
    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      background-color: #ffffff;
      color: #111111;
      margin: 0;
      padding: 0;
      transition: background-color 0.4s ease, color 0.4s ease;
    }

    
    body.dark {
      background-color: #0a0a0a; 
      color: #d4af37; 
    }

    header {
      background-color: #fdfdfd; 
      color: #111111;
      padding: 1.2rem;
      text-align: center;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      transition: background-color 0.4s ease, color 0.4s ease;
      font-weight: bold;
    }

    body.dark header {
      background-color: #111111;
      color: #d4af37;
      box-shadow: 0 2px 8px rgba(212,175,55,0.4);
    }

    main {
      max-width: 600px;
      margin: 2rem auto;
      background: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgb(0 0 0 / 0.1);
      transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
      color: #111111;
    }

    body.dark main {
      background: #121212;
      color: #d4af37;
      box-shadow: 0 6px 16px rgba(212,175,55,0.5);
    }

    h1 {
      margin: 0 0 0.3rem 0;
      font-weight: 900;
      font-size: 2.6rem;
      letter-spacing: 2px;
      text-shadow: 0 0 4px #d4af37;
    }

    body.dark h1 {
      text-shadow: 0 0 8px #ffd700;
    }

    h2 {
      font-weight: 700;
      font-size: 1.7rem;
      margin-bottom: 0.6rem;
      color: inherit;
      text-shadow: none;
    }

    select,
    button {
      font-size: 1rem;
      padding: 0.5rem 0.8rem;
      margin-right: 0.6rem;
      border-radius: 8px;
      border: 2px solid #bfa249;
      transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      font-weight: 600;
      font-family: 'Georgia', serif;
      cursor: pointer;
    }

    select {
      background-color: #fefefe;
      color: #111111;
    }

    select:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 8px #d4af37aa;
    }

    button {
      background-color: #d4af37;
      border: 2px solid #bfa249;
      color: #0a0a0a;
      font-weight: 700;
      box-shadow: 0 2px 5px rgba(212,175,55,0.6);
    }

    button:hover,
    button:focus {
      background-color: #bfa249;
      border-color: #9a8424;
      box-shadow: 0 0 12px #ffd700cc;
      color: #0a0a0a;
    }

    body.dark select {
      background-color: #222;
      color: #d4af37;
      border-color: #d4af37;
    }

    body.dark select:focus {
      border-color: #ffd700;
      box-shadow: 0 0 10px #ffd700cc;
      color: #ffd700;
      background-color: #1a1a1a;
    }

    body.dark button {
      background-color: #d4af37;
      border-color: #bfa249;
      color: #0a0a0a;
      box-shadow: 0 2px 10px rgba(212,175,55,0.9);
    }

    body.dark button:hover,
    body.dark button:focus {
      background-color: #ffd700;
      border-color: #ffd700;
      box-shadow: 0 0 15px #ffd700;
      color: #111;
    }

    #result,
    #forecast {
      background: #f9f7f1;
      border-radius: 10px;
      padding: 1.2rem 1.5rem;
      margin-top: 1.5rem;
      box-shadow: inset 0 1px 5px rgb(189 170 63 / 0.25);
      font-weight: 600;
      color: #4a3e00;
      transition: background-color 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
    }

    body.dark #result,
    body.dark #forecast {
      background: #1c1700;
      color: #ffd700;
      box-shadow: inset 0 1px 8px #ffd700cc;
    }

    p {
      line-height: 1.6;
      font-size: 1.05rem;
      margin: 0.4rem 0;
      text-shadow: 0 0 1px #bfa249cc;
    }

    body.dark p {
      text-shadow: 0 0 3px #ffd700cc;
    }

    /* å³ä¸Šè§’åˆ‡æ›æ·±æ·ºè‰²æŒ‰éˆ• */
    #themeToggleContainer {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 9999;
    }
    #btnToggleTheme {
      font-size: 0.9rem;
      padding: 0.5rem 0.9rem;
      border-radius: 8px;
      border: none;
      background-color: #d4af37;
      color: #0a0a0a;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 3px 7px rgba(212,175,55,0.7);
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      font-family: 'Georgia', serif;
    }
    #btnToggleTheme:hover {
      background-color: #ffd700;
      box-shadow: 0 0 15px #ffd700cc;
      color: #111;
    }
    body.dark #btnToggleTheme {
      background-color: #d4af37;
      color: #0a0a0a;
      box-shadow: 0 3px 10px rgba(212,175,55,0.9);
    }
    body.dark #btnToggleTheme:hover {
      background-color: #ffd700;
      box-shadow: 0 0 20px #ffd700cc;
      color: #111;
    }

    /* ç¾åœ¨æ™‚é–“æ¨£å¼ */
    #currentTime {
      text-align: center;
      font-size: 1.25rem;
      margin-bottom: 1.2rem;
      font-weight: 700;
      letter-spacing: 1.2px;
      color: #4a3e00;
      text-shadow: 0 0 2px #bfa249bb;
      transition: color 0.4s ease, text-shadow 0.4s ease;
      font-family: 'Georgia', serif;
    }
    body.dark #currentTime {
      color: #ffd700;
      text-shadow: 0 0 8px #ffd700cc;
    }
  </style>
</head>
<body>
  <!-- æ·±æ·ºè‰²åˆ‡æ›æŒ‰éˆ• -->
  <div id="themeToggleContainer">
    <button id="btnToggleTheme">åˆ‡æ›æ·±æ·ºè‰²æ¨¡å¼</button>
  </div>

  <header>
    <h1>GO OUT</h1>
    <p>æ ¹æ“šå¤©æ°£æ¨è–¦ç©¿æ­ã€ç¾é£Ÿã€æ´»å‹•</p>
  </header>
  <main>
    <div id="currentTime">è¼‰å…¥æ™‚é–“ä¸­...</div>

    <section>
      <h2>é¸æ“‡åœ°å€</h2>
      <select id="city"></select>
      <select id="town"></select>
      <button id="btnQuery">æŸ¥è©¢</button>
      <button id="btnGPS">ä½¿ç”¨GPSå®šä½</button>
    </section>

    <section id="result"></section>
    <section id="forecast"></section>
  </main>

  <script>
    // å°ç£ç¸£å¸‚èˆ‡é„‰é®è³‡æ–™
    const locationData = [
      { city: "åŸºéš†å¸‚", towns: ["ä»æ„›å€","ä¿¡ç¾©å€","ä¸­æ­£å€","ä¸­å±±å€","å®‰æ¨‚å€","æš–æš–å€","ä¸ƒå µå€"] },
      { city: "è‡ºåŒ—å¸‚", towns: ["ä¸­æ­£å€","å¤§åŒå€","ä¸­å±±å€","æ¾å±±å€","å¤§å®‰å€","è¬è¯å€","ä¿¡ç¾©å€","å£«æ—å€","åŒ—æŠ•å€","å…§æ¹–å€","å—æ¸¯å€","æ–‡å±±å€"] },
      { city: "æ–°åŒ—å¸‚", towns: ["è¬é‡Œå€","é‡‘å±±å€","æ¿æ©‹å€","æ±æ­¢å€","æ·±å‘å€","çŸ³ç¢‡å€","ç‘èŠ³å€","å¹³æºªå€","é›™æºªå€","è²¢å¯®å€","æ–°åº—å€","åªæ—å€","çƒä¾†å€","æ°¸å’Œå€","ä¸­å’Œå€","åœŸåŸå€","ä¸‰å³½å€","æ¨¹æ—å€","é¶¯æ­Œå€","ä¸‰é‡å€","æ–°èŠå€","æ³°å±±å€","æ—å£å€","è˜†æ´²å€","äº”è‚¡å€","å…«é‡Œå€","æ·¡æ°´å€","ä¸‰èŠå€","çŸ³é–€å€"] },
      { city: "æ¡ƒåœ’å¸‚", towns: ["ä¸­å£¢å€","å¹³é®å€","é¾æ½­å€","æ¥Šæ¢…å€","æ–°å±‹å€","è§€éŸ³å€","æ¡ƒåœ’å€","é¾œå±±å€","å…«å¾·å€","å¤§æºªå€","å¾©èˆˆå€","å¤§åœ’å€","è˜†ç«¹å€"] },
      { city: "è‡ºä¸­å¸‚", towns: ["ä¸­å€","æ±å€","å—å€","è¥¿å€","åŒ—å€","åŒ—å±¯å€","è¥¿å±¯å€","å—å±¯å€","å¤ªå¹³å€","å¤§é‡Œå€","éœ§å³°å€","çƒæ—¥å€","è±åŸå€","åé‡Œå€","çŸ³å²¡å€","æ±å‹¢å€","å’Œå¹³å€","æ–°ç¤¾å€","æ½­å­å€","å¤§é›…å€","ç¥å²¡å€","å¤§è‚šå€","æ²™é¹¿å€","é¾äº•å€","æ¢§æ£²å€","æ¸…æ°´å€","å¤§ç”²å€","å¤–åŸ”å€","å¤§å®‰å€"] },
      { city: "è‡ºå—å¸‚", towns: ["ä¸­è¥¿å€","æ±å€","å—å€","åŒ—å€","å®‰å¹³å€","å®‰å—å€","æ°¸åº·å€","æ­¸ä»å€","æ–°åŒ–å€","å·¦é®å€","ç‰äº•å€","æ¥ è¥¿å€","å—åŒ–å€","ä»å¾·å€","é—œå»Ÿå€","é¾å´å€","å®˜ç”°å€","éº»è±†å€","ä½³é‡Œå€","è¥¿æ¸¯å€","ä¸ƒè‚¡å€","å°‡è»å€","å­¸ç”²å€","åŒ—é–€å€","æ–°ç‡Ÿå€","å¾Œå£å€","ç™½æ²³å€","æ±å±±å€","å…­ç”²å€","ä¸‹ç‡Ÿå€","æŸ³ç‡Ÿå€","é¹½æ°´å€","å–„åŒ–å€","å¤§å…§å€","å±±ä¸Šå€","æ–°å¸‚å€","å®‰å®šå€"] },
      { city: "é«˜é›„å¸‚", towns: ["æ–°èˆˆå€","å‰é‡‘å€","è‹“é›…å€","é¹½åŸ•å€","é¼“å±±å€","æ——æ´¥å€","å‰é®å€","ä¸‰æ°‘å€","æ¥ æ¢“å€","å°æ¸¯å€","å·¦ç‡Ÿå€","ä»æ­¦å€","å¤§ç¤¾å€","å²¡å±±å€","è·¯ç«¹å€","é˜¿è“®å€","ç”°å¯®å€","ç‡•å·¢å€","æ©‹é ­å€","æ¢“å®˜å€","å½Œé™€å€","æ°¸å®‰å€","æ¹–å…§å€","é³³å±±å€","å¤§å¯®å€","æ—åœ’å€","é³¥æ¾å€","å¤§æ¨¹å€","æ——å±±å€","ç¾æ¿ƒå€","å…­é¾œå€","å…§é–€å€","æ‰æ—å€","ç”²ä»™å€","æ¡ƒæºå€","é‚£ç‘ªå¤å€","èŒ‚æ—å€","èŒ„è£å€"] },
      { city: "æ–°ç«¹å¸‚", towns: ["æ±å€","åŒ—å€","é¦™å±±å€"] },
      { city: "æ–°ç«¹ç¸£", towns: ["ç«¹åŒ—å¸‚","æ¹–å£é„‰","æ–°è±é„‰","æ–°åŸ”é®","é—œè¥¿é®","èŠæ—é„‰","å¯¶å±±é„‰","ç«¹æ±é®","äº”å³°é„‰","æ©«å±±é„‰","å°–çŸ³é„‰","åŒ—åŸ”é„‰","å³¨çœ‰é„‰"] },
      { city: "è‹—æ —ç¸£", towns: ["ç«¹å—é®","é ­ä»½å¸‚","ä¸‰ç£é„‰","å—åº„é„‰","ç…æ½­é„‰","å¾Œé¾é®","é€šéœ„é®","è‹‘è£¡é®","è‹—æ —å¸‚","é€ æ©‹é„‰","é ­å±‹é„‰","å…¬é¤¨é„‰","å¤§æ¹–é„‰","æ³°å®‰é„‰","éŠ…é‘¼é„‰","ä¸‰ç¾©é„‰","è¥¿æ¹–é„‰","å“è˜­é®"] },
      { city: "å½°åŒ–ç¸£", towns: ["å½°åŒ–å¸‚","èŠ¬åœ’é„‰","èŠ±å£‡é„‰","ç§€æ°´é„‰","é¹¿æ¸¯é®","ç¦èˆˆé„‰","ç·šè¥¿é„‰","å’Œç¾é®","ä¼¸æ¸¯é„‰","å“¡æ—å¸‚","ç¤¾é ­é„‰","æ°¸é–é„‰","åŸ”å¿ƒé„‰","æºªæ¹–é®","å¤§æ‘é„‰","åŸ”é¹½é„‰","ç”°ä¸­é®","åŒ—æ–—é®","ç”°å°¾é„‰","åŸ¤é ­é„‰","æºªå·é„‰","ç«¹å¡˜é„‰","äºŒæ—é®","å¤§åŸé„‰","èŠ³è‹‘é„‰","äºŒæ°´é„‰"] },
      { city: "å—æŠ•ç¸£", towns: ["å—æŠ•å¸‚","ä¸­å¯®é„‰","è‰å±¯é®","åœ‹å§“é„‰","åŸ”é‡Œé®","ä»æ„›é„‰","åé–“é„‰","é›†é›†é®","æ°´é‡Œé„‰","é­šæ± é„‰","ä¿¡ç¾©é„‰","ç«¹å±±é®","é¹¿è°·é„‰"] },
      { city: "é›²æ—ç¸£", towns: ["æ–—å…­å¸‚","æ—å…§é„‰","å¤å‘é„‰","è¿æ¡é„‰","è¥¿èºé®","äºŒå´™é„‰","å´™èƒŒé„‰","éº¥å¯®é„‰","æ±å‹¢é„‰","è‡ºè¥¿é„‰","å…ƒé•·é„‰","å››æ¹–é„‰","å£æ¹–é„‰","æ°´æ—é„‰"] },
      { city: "å˜‰ç¾©å¸‚", towns: ["æ±å€","è¥¿å€"] },
      { city: "å˜‰ç¾©ç¸£", towns: ["ç•ªè·¯é„‰","æ¢…å±±é„‰","ç«¹å´é„‰","é˜¿é‡Œå±±é„‰","ä¸­åŸ”é„‰","å¤§åŸ”é„‰","æ°´ä¸Šé„‰","é¹¿è‰é„‰","å¤ªä¿å¸‚","æœ´å­å¸‚","æ±çŸ³é„‰","ç¾©ç«¹é„‰","å¸ƒè¢‹é®"] },
      { city: "è‡ºæ±ç¸£", towns: ["è‡ºæ±å¸‚","ç¶ å³¶é„‰","è˜­å¶¼é„‰","å»¶å¹³é„‰","å‘å—é„‰","é¹¿é‡é„‰","é—œå±±é®","æµ·ç«¯é„‰","æ± ä¸Šé„‰","æ±æ²³é„‰","æˆåŠŸé®","é•·æ¿±é„‰","å¤ªéº»é‡Œé„‰","é‡‘å³°é„‰","å¤§æ­¦é„‰","é”ä»é„‰"] },
      { city: "èŠ±è“®ç¸£", towns: ["èŠ±è“®å¸‚","æ–°åŸé„‰","ç§€æ—é„‰","å‰å®‰é„‰","å£½è±é„‰","é³³æ—é®","å…‰å¾©é„‰","è±æ¿±é„‰","ç‘ç©—é„‰","è¬æ¦®é„‰","ç‰é‡Œé®","å“æºªé„‰","å¯Œé‡Œé„‰"] },
      { city: "æ¾æ¹–ç¸£", towns: ["é¦¬å…¬å¸‚","è¥¿å¶¼é„‰","æœ›å®‰é„‰","ä¸ƒç¾é„‰","ç™½æ²™é„‰","æ¹–è¥¿é„‰"] },
      { city: "é‡‘é–€ç¸£", towns: ["é‡‘æ²™é®","é‡‘æ¹–é®","é‡‘å¯§é„‰","é‡‘åŸé®","çƒˆå¶¼é„‰","çƒåµé„‰"] },
      { city: "é€£æ±Ÿç¸£", towns: ["å—ç«¿é„‰","åŒ—ç«¿é„‰","è’å…‰é„‰","æ±å¼•é„‰"] }
    ];

    // è¼‰å…¥ç¸£å¸‚é„‰é®é¸å–®
    function loadAreaData() {
      const citySelect = document.getElementById("city");
      const townSelect = document.getElementById("town");

      citySelect.innerHTML = '<option value="">è«‹é¸æ“‡ç¸£å¸‚</option>';
      locationData.forEach((loc) => {
        const opt = document.createElement("option");
        opt.value = loc.city;
        opt.textContent = loc.city;
        citySelect.appendChild(opt);
      });

      citySelect.addEventListener("change", () => {
        const selected = locationData.find((l) => l.city === citySelect.value);
        townSelect.innerHTML = '<option value="">è«‹é¸æ“‡é„‰é®</option>';
        if (selected) {
          selected.towns.forEach((town) => {
            const opt = document.createElement("option");
            opt.value = town;
            opt.textContent = town;
            townSelect.appendChild(opt);
          });
        }
      });
    }

    // ä½¿ç”¨ GPS å®šä½ä¸¦åæŸ¥åœ°å€
    async function getLocation() {
      if (!navigator.geolocation) {
        alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´GPSå®šä½");
        return;
      }
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        try {
          const res = await fetch(
            `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`
          );
          const json = await res.json();
          const county = json.address.county || json.address.city;
          const town =
            json.address.town || json.address.village || json.address.suburb || "";

          // è¨­å®šé¸å–®é¸æ“‡å€¼
          const citySelect = document.getElementById("city");
          const townSelect = document.getElementById("town");
          citySelect.value = county;
          citySelect.dispatchEvent(new Event("change"));

          setTimeout(() => {
            townSelect.value = town;
          }, 300);
        } catch {
          alert("å®šä½å¤±æ•—ï¼Œç„¡æ³•åæŸ¥åœ°å€");
        }
      });
    }

    // å–å¾—å¤©æ°£è³‡æ–™ä¸¦é¡¯ç¤ºå»ºè­°
    async function getWeather() {
      const city = document.getElementById("city").value;
      const town = document.getElementById("town").value;
      if (!city) {
        alert("è«‹å…ˆé¸æ“‡ç¸£å¸‚");
        return;
      }

      const result = document.getElementById("result");
      const forecast = document.getElementById("forecast");

      result.innerHTML = forecast.innerHTML = "è¼‰å…¥ä¸­...";

      try {
        const res = await fetch(
          `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=CWA-B25B8495-0958-48BC-8DC3-E11DDBA0AE26&locationName=${city}`
        );
        const data = await res.json();

        if (!data.records || data.records.location.length === 0) {
          result.innerHTML = "æ‰¾ä¸åˆ°å¤©æ°£è³‡æ–™ï¼Œè«‹ç¢ºèªé¸æ“‡çš„ç¸£å¸‚åç¨±";
          forecast.innerHTML = "";
          return;
        }

        const loc = data.records.location.find((l) => l.locationName === city) || data.records.location[0];

        const weather = loc.weatherElement[0].time[0].parameter.parameterName;
        const rain = loc.weatherElement[1].time[0].parameter.parameterName;
        const tempMin = loc.weatherElement[2].time[0].parameter.parameterName;
        const tempMax = loc.weatherElement[4].time[0].parameter.parameterName;

        let activity = "";
        if (weather.includes("é›¨")) activity = "â˜” å»ºè­°åœ¨å®¶çœ‹ Netflix æˆ–é–±è®€æ›¸ç±";
        else if (weather.includes("æ™´"))
          activity = "â˜€ï¸ å¯ä»¥å»æµ·é‚Šã€æ‰“ç±ƒçƒã€è·‘æ­¥";
        else activity = "â˜ï¸ å®¤å…§å¤–æ´»å‹•çš†å¯";

        if (["èŠ±è“®ç¸£", "è‡ºæ±ç¸£", "é«˜é›„å¸‚", "æ¾æ¹–ç¸£"].some((k) => city.includes(k)))
          activity += "ï¼Œé æµ·å»ºè­°å»çœ‹æµ·ã€åƒæµ·é®®";
        if (["å—æŠ•ç¸£", "è‹—æ —ç¸£", "æ–°ç«¹ç¸£", "å˜‰ç¾©ç¸£"].some((k) => city.includes(k)))
          activity += "ï¼Œé å±±å¯å»é¨è»Šã€çˆ¬å±±";

        result.innerHTML = `
          <h3>${city} ${town} å¤©æ°£å»ºè­°</h3>
          <p>ğŸŒ¤ï¸ ç‹€æ³ï¼š${weather}</p>
          <p>ğŸŒ¡ï¸ æº«åº¦ï¼š${tempMin} ~ ${tempMax}Â°C</p>
          <p>ğŸ’§ é™é›¨ç‡ï¼š${rain}%</p>
          <p>ğŸ¯ æ´»å‹•å»ºè­°ï¼š${activity}</p>
        `;

        forecast.innerHTML =
          `<h4>ğŸ“… æœªä¾†é å ±</h4>` +
          loc.weatherElement[0].time
            .slice(0, 3)
            .map(
              (t) =>
                `<p>${t.startTime
                  .split(" ")[1]
                  .slice(0, 5)} - ${t.parameter.parameterName}</p>`
            )
            .join("");
      } catch (e) {
        console.error(e);
        result.innerHTML = "å–å¾—å¤©æ°£è³‡æ–™å¤±æ•—";
        forecast.innerHTML = "";
      }
    }

    // ç¾åœ¨æ™‚é–“é¡¯ç¤º
    function updateTime() {
      const now = new Date();
      const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
      const w = weekdays[now.getDay()];
      const hh = String(now.getHours()).padStart(2, '0');
      const mm = String(now.getMinutes()).padStart(2, '0');
      const ss = String(now.getSeconds()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const timeStr = `${w} ${hh}:${mm}:${ss} ${month}æœˆ${day}æ—¥`;
      document.getElementById('currentTime').textContent = timeStr;
    }

    // æ·±æ·ºè‰²æ¨¡å¼åˆ‡æ›
    const btnToggleTheme = document.getElementById('btnToggleTheme');
    btnToggleTheme.addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    window.onload = () => {
      loadAreaData();
      document.getElementById("btnQuery").onclick = getWeather;
      document.getElementById("btnGPS").onclick = getLocation;
      updateTime();
      setInterval(updateTime, 1000);
    };
  </script>
</body>
</html>
